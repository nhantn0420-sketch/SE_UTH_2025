# 3.4. NON-FUNCTIONAL REQUIREMENTS

**Yêu cầu Phi Chức năng - Chất lượng Hệ thống**

---

## 3.4.1. Overview

Non-Functional Requirements (NFRs) định nghĩa **chất lượng và ràng buộc** của hệ thống CollabSphere. Các NFRs được phân loại theo **ISO/IEC 25010 Software Quality Model**:

1. **Performance** - Hiệu năng và thời gian đáp ứng
2. **Security** - Bảo mật và quyền riêng tư
3. **Usability** - Tính dễ sử dụng
4. **Reliability** - Độ tin cậy và sẵn sàng
5. **Scalability** - Khả năng mở rộng
6. **Maintainability** - Tính bảo trì
7. **Portability** - Tính di động
8. **Compatibility** - Tương thích

---

## 3.4.2. PERFORMANCE REQUIREMENTS

### **NFR-01: Response Time**

| **Attribute** | **Details** |
|---------------|-------------|
| **ID** | NFR-01 |
| **Category** | Performance |
| **Priority** | MUST |

**Requirement:**  
Hệ thống phải đảm bảo thời gian đáp ứng nhanh cho các thao tác người dùng.

**Metrics:**
- **API Response Time:**
  - Simple queries (GET user, GET class): < 200ms (95th percentile)
  - Complex queries (GET group progress with aggregations): < 500ms (95th percentile)
  - File upload initiation: < 100ms (authentication + pre-signed URL)
  - Search operations: < 300ms (95th percentile)

- **Page Load Time:**
  - Initial page load (cold start): < 3 seconds
  - Subsequent navigation (SPA): < 500ms
  - Real-time updates (WebSocket): < 200ms latency

- **Database Query Performance:**
  - Single record retrieval: < 50ms
  - List queries with pagination: < 100ms
  - Joins (< 3 tables): < 150ms
  - Aggregations: < 300ms

**Testing Method:**
- Load testing with JMeter or Locust
- Monitor with application performance monitoring (APM) tools
- Log response times in production

**Acceptance Criteria:**
- 95% of requests meet above thresholds
- 99% of requests < 2x threshold
- No request > 10 seconds (timeout)

---

### **NFR-02: Throughput**

| **Attribute** | **Details** |
|---------------|-------------|
| **ID** | NFR-02 |
| **Category** | Performance |
| **Priority** | SHOULD |

**Requirement:**  
Hệ thống phải xử lý được số lượng requests đồng thời cao.

**Metrics:**
- **Concurrent Users:** 500 simultaneous active users
- **Requests per Second:** 1000 RPS sustained, 2000 RPS peak (1-minute)
- **WebSocket Connections:** 500 concurrent connections
- **File Uploads:** 50 concurrent uploads (max 100MB each)

**Acceptance Criteria:**
- System maintains response time SLAs under load
- No request failures due to resource exhaustion
- Graceful degradation under extreme load

---

### **NFR-03: Resource Usage**

| **Attribute** | **Details** |
|---------------|-------------|
| **ID** | NFR-03 |
| **Category** | Performance |
| **Priority** | SHOULD |

**Requirement:**  
Hệ thống sử dụng tài nguyên server hiệu quả.

**Metrics:**
- **CPU Usage:** < 70% average, < 90% peak (per server)
- **Memory Usage:** < 4GB RAM for backend server (500 users)
- **Database Connections:** Max 50 concurrent connections per server
- **Network Bandwidth:** < 10 Mbps average (excluding file uploads/video)

**Acceptance Criteria:**
- No memory leaks (memory usage stable over 24 hours)
- CPU usage does not spike > 95% for > 30 seconds

---

### **NFR-04: Client Performance**

| **Attribute** | **Details** |
|---------------|-------------|
| **ID** | NFR-04 |
| **Category** | Performance |
| **Priority** | SHOULD |

**Requirement:**  
Ứng dụng web chạy mượt mà trên client devices.

**Metrics:**
- **JavaScript Bundle Size:** < 2MB (gzipped)
- **Memory Usage (Browser):** < 500MB (normal usage), < 1GB (video call)
- **Frame Rate:** 60 FPS for UI animations
- **First Contentful Paint:** < 1.5 seconds
- **Time to Interactive:** < 3 seconds

**Acceptance Criteria:**
- Lighthouse Performance Score > 80
- No UI lag during typing or scrolling
- Smooth transitions and animations

---

## 3.4.3. SECURITY REQUIREMENTS

### **NFR-05: Authentication & Authorization**

| **Attribute** | **Details** |
|---------------|-------------|
| **ID** | NFR-05 |
| **Category** | Security |
| **Priority** | MUST |

**Requirement:**  
Hệ thống phải xác thực và phân quyền người dùng một cách an toàn.

**Specifications:**
- **Authentication:**
  - JWT (JSON Web Tokens) with HS256 algorithm
  - Token expiration: 24 hours (slidingwindow refresh)
  - Password hashing: bcrypt with salt (cost factor 12)
  - Failed login tracking: Max 5 attempts, 15-minute lockout
  - No plain-text passwords stored or transmitted

- **Authorization:**
  - Role-Based Access Control (RBAC) with 5 roles
  - API endpoints verify user role on every request
  - Frontend hides unauthorized UI elements
  - 403 Forbidden for unauthorized access attempts

- **Session Management:**
  - Secure cookie flags: HttpOnly, Secure, SameSite=Strict
  - Session invalidation on logout
  - All sessions invalidated on password change

**Testing Method:**
- Penetration testing for auth bypasses
- OWASP ZAP automated security scans
- Manual testing of role-based restrictions

**Acceptance Criteria:**
- No authentication bypass vulnerabilities
- All endpoints protected by JWT validation
- Passwords never logged or exposed

---

### **NFR-06: Data Protection**

| **Attribute** | **Details** |
|---------------|-------------|
| **ID** | NFR-06 |
| **Category** | Security |
| **Priority** | MUST |

**Requirement:**  
Dữ liệu người dùng phải được bảo vệ khỏi truy cập trái phép.

**Specifications:**
- **Encryption in Transit:**
  - HTTPS (TLS 1.2+) for all communications
  - WebSocket over TLS (wss://)
  - Certificate from trusted CA (Let's Encrypt, etc.)
  - HSTS header enabled (max-age=31536000)

- **Encryption at Rest:**
  - Database encryption for sensitive fields (passwords, tokens)
  - File storage encryption (Cloudinary/S3 server-side encryption)
  - Backup encryption (AES-256)

- **Data Privacy:**
  - Personal data (email, name) only visible to authorized users
  - Peer evaluations anonymous to other students
  - Admin logs access to sensitive data

**Acceptance Criteria:**
- All HTTP traffic redirected to HTTPS
- SSL Labs test score: A or higher
- No sensitive data in logs or error messages

---

### **NFR-07: Input Validation & Injection Prevention**

| **Attribute** | **Details** |
|---------------|-------------|
| **ID** | NFR-07 |
| **Category** | Security |
| **Priority** | MUST |

**Requirement:**  
Hệ thống phải validate tất cả inputs và prevent injection attacks.

**Specifications:**
- **SQL Injection Prevention:**
  - Use SQLModel ORM (parameterized queries)
  - No raw SQL queries with user input
  - Input sanitization for search queries

- **XSS (Cross-Site Scripting) Prevention:**
  - Output encoding for all user-generated content
  - Content Security Policy (CSP) headers
  - React's built-in XSS protection (JSX escaping)

- **Input Validation:**
  - Server-side validation for all inputs (never trust client)
  - Whitelist allowed characters for each field
  - Max length enforced (title: 200 chars, description: 2000 chars)
  - File upload: Check MIME type and extension
  - Rate limiting on API endpoints (100 req/min per user)

**Testing Method:**
- OWASP Top 10 vulnerability testing
- Fuzz testing with malicious inputs
- Code review for unsafe practices

**Acceptance Criteria:**
- No SQL injection vulnerabilities
- No stored or reflected XSS
- All inputs validated on server

---

### **NFR-08: CORS & API Security**

| **Attribute** | **Details** |
|---------------|-------------|
| **ID** | NFR-08 |
| **Category** | Security |
| **Priority** | MUST |

**Requirement:**  
API endpoints phải được bảo vệ khỏi unauthorized cross-origin requests.

**Specifications:**
- **CORS Policy:**
  - Allow origins: Only frontend domain (e.g., https://collabsphere.app)
  - Credentials: Allow (for cookies)
  - Methods: GET, POST, PUT, PATCH, DELETE
  - Headers: Authorization, Content-Type

- **API Security:**
  - Rate limiting: 100 requests/minute per user
  - DDoS protection: Cloudflare or similar
  - API keys for external integrations (future)

**Acceptance Criteria:**
- CORS headers properly configured
- Cross-origin requests from unauthorized domains blocked

---

## 3.4.4. USABILITY REQUIREMENTS

### **NFR-09: User Interface Design**

| **Attribute** | **Details** |
|---------------|-------------|
| **ID** | NFR-09 |
| **Category** | Usability |
| **Priority** | MUST |

**Requirement:**  
Giao diện phải trực quan, dễ sử dụng, và nhất quán.

**Specifications:**
- **Design System:**
  - Material-UI (MUI) or Ant Design components
  - Consistent color scheme (primary, secondary, accent)
  - Typography hierarchy (headings, body, captions)
  - Spacing and layout grid (8px base unit)

- **Navigation:**
  - Clear navigation bar with role-based menu items
  - Breadcrumbs for nested pages
  - Search bar always accessible
  - Max 3 clicks to reach any feature

- **Responsive Design:**
  - Mobile-friendly (tablet 768px+, desktop 1366px+)
  - Touch-friendly buttons (min 44x44px)
  - Collapsible sidebars on small screens

- **Feedback:**
  - Loading spinners for async operations
  - Success/error toast notifications
  - Inline validation messages
  - Confirmation dialogs for destructive actions

**Testing Method:**
- User acceptance testing (UAT) with 10+ users
- A/B testing for critical workflows
- Heatmap analysis (Hotjar, Clarity)

**Acceptance Criteria:**
- SUS (System Usability Scale) score > 70
- Task completion rate > 90% for primary workflows
- User satisfaction rating > 4/5

---

### **NFR-10: Accessibility**

| **Attribute** | **Details** |
|---------------|-------------|
| **ID** | NFR-10 |
| **Category** | Usability |
| **Priority** | SHOULD |

**Requirement:**  
Hệ thống phải accessible cho người khuyết tật (WCAG 2.1 Level A).

**Specifications:**
- **Keyboard Navigation:**
  - All interactive elements accessible via Tab
  - Focus indicators visible
  - Keyboard shortcuts for common actions

- **Screen Reader Support:**
  - Semantic HTML (header, nav, main, article)
  - ARIA labels for icons and buttons
  - Alt text for images

- **Color Contrast:**
  - Text contrast ratio ≥ 4.5:1 (normal text)
  - Text contrast ratio ≥ 3:1 (large text)
  - No color-only information (use icons + text)

**Testing Method:**
- Lighthouse Accessibility audit
- Screen reader testing (NVDA, JAWS)
- Keyboard-only navigation testing

**Acceptance Criteria:**
- Lighthouse Accessibility Score > 90
- WCAG 2.1 Level A compliance

---

### **NFR-11: Learnability**

| **Attribute** | **Details** |
|---------------|-------------|
| **ID** | NFR-11 |
| **Category** | Usability |
| **Priority** | SHOULD |

**Requirement:**  
Người dùng mới có thể học cách sử dụng hệ thống nhanh chóng.

**Specifications:**
- **Onboarding:**
  - First-time user tutorial (optional walkthrough)
  - Tooltips for complex features
  - Empty state messages with CTAs (e.g., "Create your first project")

- **Help System:**
  - ? icon in header → Help documentation
  - Context-sensitive help (tooltips on hover)
  - FAQ page
  - In-app chat support (optional)

- **Error Messages:**
  - Clear, actionable error messages
  - Example: "Email already exists. Try logging in instead."
  - No technical jargon

**Acceptance Criteria:**
- New users complete first task < 5 minutes (with tutorial)
- < 10% support requests for basic operations

---

## 3.4.5. RELIABILITY REQUIREMENTS

### **NFR-12: Availability**

| **Attribute** | **Details** |
|---------------|-------------|
| **ID** | NFR-12 |
| **Category** | Reliability |
| **Priority** | MUST |

**Requirement:**  
Hệ thống phải có uptime cao và ít downtime.

**Metrics:**
- **Uptime Target:** 99% (allows ~7 hours downtime/month)
- **Scheduled Maintenance:** Max 2 hours/month, announced 48h advance
- **Unplanned Downtime:** < 1 hour/month

**Specifications:**
- **Monitoring:**
  - Health check endpoint (/health) every 30 seconds
  - Alerting on failures (email, SMS to admin)
  - Status page for users (status.collabsphere.app)

- **Redundancy:**
  - Multiple server instances (load balanced)
  - Database replication (master-slave)
  - CDN for static assets

**Testing Method:**
- Uptime monitoring (Pingdom, UptimeRobot)
- Chaos engineering (random server shutdowns)

**Acceptance Criteria:**
- 99% uptime over 30-day period
- Incident response time < 30 minutes

---

### **NFR-13: Fault Tolerance**

| **Attribute** | **Details** |
|---------------|-------------|
| **ID** | NFR-13 |
| **Category** | Reliability |
| **Priority** | SHOULD |

**Requirement:**  
Hệ thống phải hoạt động được khi một số thành phần fail.

**Specifications:**
- **Graceful Degradation:**
  - AI service down → Manual milestone creation still works
  - Email service down → In-app notifications still work
  - WebSocket down → Fall back to HTTP polling

- **Error Handling:**
  - All exceptions caught and logged
  - User-friendly error pages (not stack traces)
  - Retry mechanism for transient failures (3 retries with exponential backoff)

- **Data Integrity:**
  - Database transactions for critical operations
  - Rollback on failure
  - Validation before commit

**Acceptance Criteria:**
- System remains functional with 1 service failure
- No data loss during failures

---

### **NFR-14: Backup & Recovery**

| **Attribute** | **Details** |
|---------------|-------------|
| **ID** | NFR-14 |
| **Category** | Reliability |
| **Priority** | MUST |

**Requirement:**  
Dữ liệu phải được backup định kỳ và có thể restore.

**Specifications:**
- **Database Backup:**
  - Daily full backups (automated)
  - Incremental backups every 6 hours
  - Retention: 30 days
  - Offsite storage (AWS S3 Glacier or Azure Blob)

- **File Storage Backup:**
  - Cloud storage provider handles backups (Cloudinary, S3)
  - Versioning enabled

- **Recovery:**
  - RTO (Recovery Time Objective): < 4 hours
  - RPO (Recovery Point Objective): < 6 hours (max data loss)
  - Disaster recovery plan documented

**Testing Method:**
- Quarterly restore drills
- Verify backup integrity monthly

**Acceptance Criteria:**
- Successful restore from backup within 4 hours
- All backups encrypted

---

## 3.4.6. SCALABILITY REQUIREMENTS

### **NFR-15: Horizontal Scalability**

| **Attribute** | **Details** |
|---------------|-------------|
| **ID** | NFR-15 |
| **Category** | Scalability |
| **Priority** | SHOULD |

**Requirement:**  
Hệ thống có thể scale out để phục vụ nhiều users hơn.

**Specifications:**
- **Stateless Backend:**
  - API servers stateless (no session storage on server)
  - JWT tokens eliminate need for session database
  - WebSocket connections handled by separate service

- **Load Balancing:**
  - Nginx or cloud load balancer (AWS ALB, Azure LB)
  - Round-robin or least-connections algorithm
  - Health checks for backend servers

- **Database Scalability:**
  - Read replicas for heavy read operations
  - Connection pooling (max 50 connections per server)
  - Caching layer (Redis) for frequent queries

**Acceptance Criteria:**
- Add server instance without code changes
- Linear scaling up to 10 servers (5000 users)

---

### **NFR-16: Data Growth**

| **Attribute** | **Details** |
|---------------|-------------|
| **ID** | NFR-16 |
| **Category** | Scalability |
| **Priority** | SHOULD |

**Requirement:**  
Hệ thống xử lý được database lớn (millions of records).

**Specifications:**
- **Database Optimization:**
  - Indexes on foreign keys and frequently queried fields
  - Partitioning for large tables (e.g., chat messages by month)
  - Archiving old data (projects > 2 years)

- **Query Optimization:**
  - Limit result sets (pagination required)
  - Avoid N+1 queries (use eager loading)
  - Query timeout: 30 seconds max

**Acceptance Criteria:**
- Database size < 100GB for 2000 users (1 year)
- Query performance stable up to 10M records

---

## 3.4.7. MAINTAINABILITY REQUIREMENTS

### **NFR-17: Code Quality**

| **Attribute** | **Details** |
|---------------|-------------|
| **ID** | NFR-17 |
| **Category** | Maintainability |
| **Priority** | SHOULD |

**Requirement:**  
Code phải clean, maintainable, và well-documented.

**Specifications:**
- **Code Standards:**
  - Python: PEP 8 (enforced by flake8, black formatter)
  - JavaScript: ESLint with Airbnb config
  - Max function length: 50 lines
  - Max file length: 500 lines

- **Documentation:**
  - Docstrings for all public functions
  - API documentation (Swagger/OpenAPI)
  - README for setup instructions
  - Architecture diagram

- **Testing:**
  - Unit tests: > 70% code coverage
  - Integration tests for API endpoints
  - E2E tests for critical workflows

**Testing Method:**
- SonarQube code quality checks
- Code review before merge

**Acceptance Criteria:**
- SonarQube rating: A (Maintainability)
- 0 critical code smells

---

### **NFR-18: Logging & Monitoring**

| **Attribute** | **Details** |
|---------------|-------------|
| **ID** | NFR-18 |
| **Category** | Maintainability |
| **Priority** | MUST |

**Requirement:**  
Hệ thống phải log đầy đủ để troubleshoot issues.

**Specifications:**
- **Application Logs:**
  - Log levels: DEBUG, INFO, WARNING, ERROR, CRITICAL
  - Structured logging (JSON format)
  - Log rotation (daily, max 30 days)

- **Log Content:**
  - Request ID for tracing
  - User ID (for auditing)
  - Timestamp, log level, message
  - Stack trace for errors

- **Monitoring:**
  - Application Performance Monitoring (APM) - New Relic, Datadog
  - Error tracking - Sentry
  - Custom metrics (Prometheus + Grafana)

**Acceptance Criteria:**
- All errors logged with stack traces
- Logs searchable and filterable

---

## 3.4.8. PORTABILITY REQUIREMENTS

### **NFR-19: Platform Independence**

| **Attribute** | **Details** |
|---------------|-------------|
| **ID** | NFR-19 |
| **Category** | Portability |
| **Priority** | SHOULD |

**Requirement:**  
Hệ thống có thể deploy trên nhiều platforms.

**Specifications:**
- **Containerization:**
  - Docker containers for all services
  - Docker Compose for local development
  - Kubernetes-ready (Helm charts)

- **Cloud Agnostic:**
  - Can deploy to AWS, Azure, or Google Cloud
  - Use standard protocols (HTTP, WebSocket, SMTP)
  - No vendor-specific APIs in core code

**Acceptance Criteria:**
- Deploy to 2 different cloud providers successfully

---

### **NFR-20: Browser Compatibility**

| **Attribute** | **Details** |
|---------------|-------------|
| **ID** | NFR-20 |
| **Category** | Portability |
| **Priority** | MUST |

**Requirement:**  
Hệ thống hoạt động trên các browsers phổ biến.

**Specifications:**
- **Supported Browsers:**
  - Chrome 90+ (recommended)
  - Firefox 88+
  - Microsoft Edge 90+
  - Safari 14+

- **Not Supported:**
  - Internet Explorer (any version)
  - Opera Mini

- **Progressive Enhancement:**
  - Basic functionality without JavaScript (login page)
  - Graceful fallback for unsupported features

**Testing Method:**
- BrowserStack cross-browser testing
- Manual testing on target browsers

**Acceptance Criteria:**
- All features work on supported browsers
- Polyfills for missing APIs (WebSocket, WebRTC)

---

## 3.4.9. COMPATIBILITY REQUIREMENTS

### **NFR-21: API Versioning**

| **Attribute** | **Details** |
|---------------|-------------|
| **ID** | NFR-21 |
| **Category** | Compatibility |
| **Priority** | SHOULD |

**Requirement:**  
API changes không phá vỡ existing clients.

**Specifications:**
- **Versioning Strategy:**
  - URL-based versioning: `/api/v1/users`
  - Support 2 versions simultaneously during migration
  - Deprecation notice 3 months before removal

- **Backward Compatibility:**
  - New fields added as optional
  - Old fields marked deprecated but still work
  - Breaking changes only in new major version

**Acceptance Criteria:**
- Old clients continue working after API updates (minor versions)

---

### **NFR-22: Data Format Standards**

| **Attribute** | **Details** |
|---------------|-------------|
| **ID** | NFR-22 |
| **Category** | Compatibility |
| **Priority** | MUST |

**Requirement:**  
Dữ liệu sử dụng standard formats.

**Specifications:**
- **Date/Time:** ISO 8601 (e.g., `2026-01-03T14:30:00Z`)
- **Currency:** USD (if applicable)
- **Text Encoding:** UTF-8
- **JSON:** camelCase for API responses
- **File Formats:** Standard formats only (PDF, DOCX, PNG, JPG)

**Acceptance Criteria:**
- All dates in ISO 8601
- No proprietary formats

---

## 3.4.10. NFR PRIORITY SUMMARY

| Priority | Count | Categories |
|----------|-------|------------|
| **MUST** | 12 | Performance (2), Security (4), Usability (1), Reliability (2), Logging (1), Browser (1), Data Format (1) |
| **SHOULD** | 10 | Performance (2), Usability (2), Reliability (1), Scalability (2), Maintainability (1), Portability (2) |

**Critical NFRs (MUST implement for MVP):**
- NFR-01 (Response time), NFR-05 (Auth), NFR-06 (Data protection), NFR-07 (Input validation), NFR-08 (CORS), NFR-09 (UI design), NFR-12 (Availability), NFR-14 (Backup), NFR-18 (Logging), NFR-20 (Browser compatibility), NFR-22 (Data formats)

---

## 3.4.11. NFR Testing Strategy

### Performance Testing
- **Tools:** JMeter, Locust, k6
- **Frequency:** Before each release
- **Metrics:** Response time, throughput, resource usage

### Security Testing
- **Tools:** OWASP ZAP, Burp Suite, Snyk
- **Frequency:** Quarterly + before major releases
- **Scope:** OWASP Top 10, penetration testing

### Usability Testing
- **Tools:** User interviews, surveys, Hotjar
- **Frequency:** After major UI changes
- **Metrics:** SUS score, task completion rate

### Reliability Testing
- **Tools:** Chaos Monkey, uptime monitors
- **Frequency:** Continuous (monitoring), quarterly (chaos)
- **Metrics:** Uptime %, MTTR (Mean Time To Repair)

---

**[← Back to Master SRS](../03-SRS.md)** | **[Next: 3.5 Requirement Appendix →](3.5-RequirementAppendix.md)**
