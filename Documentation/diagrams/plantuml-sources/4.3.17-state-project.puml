@startuml 4.3.17-state-project
!theme plain

' ============================================
' STYLING
' ============================================
skinparam stateFontSize 11
skinparam stateFontName Arial
skinparam backgroundColor #FAFAFA
skinparam roundcorner 5
skinparam shadowing false

' State styling
skinparam state {
    BackgroundColor #FFFFFF
    BorderColor #1976D2
    BorderThickness 2
    FontStyle bold
    FontSize 11
    AttributeFontSize 9
}

' Arrow styling
skinparam arrow {
    Color #424242
    Thickness 2
    FontSize 9
}

' Title
title <size:16><b>Project Lifecycle - State Machine Diagram</b></size>\n<size:11>UML 2.5 State Machine for Project Entity</size>

' ============================================
' STATE MACHINE
' ============================================

[*] --> Draft : create() / initializeProject()

state Draft <<state>> {
  Draft : entry / initializeProjectData()
  Draft : do / enableEditing()
  Draft : exit / validateRequiredFields()
}

Draft --> Pending : submit() [isComplete() && hasAllFields()]
Draft --> [*] : delete() [lecturer.canDelete()]

state Pending <<state>> {
  Pending : entry / notifyDepartmentHead()
  Pending : do / waitForReview()
  Pending : exit / recordDecision()
}

Pending --> Approved : approve() [head.canApprove() && meetsCriteria()]
Pending --> Rejected : reject() [head.canReject() && !meetsCriteria()]
Pending --> Draft : requestRevision() [needsModification()]

state Rejected <<final state>> {
  Rejected : entry / sendRejectionNotification()
  Rejected : do / storeRejectionReason()
  Rejected : exit / archiveProject()
}

Rejected --> [*] : [autoArchive()]

state Approved <<state>> {
  Approved : entry / notifyLecturer()
  Approved : do / makeAvailableForAssignment()
  Approved : exit / updateClassAssignments()
}

Approved --> Active : assignToClass() [hasSelectedClass()]
Approved --> Archived : [semesterEnds() && !assigned]

state Active <<composite state>> {
  Active : entry / createMilestones()
  Active : do / trackProgress()
  Active : exit / calculateFinalGrades()
  
  [*] --> InProgress
  
  state InProgress <<substate>> {
    InProgress : do / monitorWorkProgress()
  }
  
  state Tracking <<substate>> {
    Tracking : do / checkMilestoneStatus()
  }
  
  InProgress --> Tracking : milestoneDeadline() [hasActiveMilestone()]
  Tracking --> InProgress : continueWork() [milestoneCompleted()]
}

Active --> Completed : finish() [allGroupsComplete() && semesterEnds()]
Active --> Suspended : pause() [emergencyOccurred() && isForceMajeure()]

state Suspended <<state>> {
  Suspended : entry / freezeAllActivities()
  Suspended : do / preserveCurrentState()
  Suspended : exit / prepareResume()
}

Suspended --> Active : resume() [issueResolved()]
Suspended --> Cancelled : terminate() [!canContinue()]

state Completed <<state>> {
  Completed : entry / lockAllGrades()
  Completed : do / generateReports()
  Completed : exit / prepareArchival()
}

Completed --> Archived : archive() [reviewCompleted()]

state Cancelled <<state>> {
  Cancelled : entry / notifyAllStakeholders()
  Cancelled : do / recordCancellationReason()
  Cancelled : exit / cleanupResources()
}

Cancelled --> Archived : archive() [cleanupComplete()]

state Archived <<final state>> {
  Archived : entry / storeHistoricalData()
  Archived : do / enableReadOnlyAccess()
  Archived : exit / schedulePermamentDeletion()
}

Archived --> [*] : deletePermanently() [retentionPeriodExpired()]

note right of Draft
  <b><<state>> Draft</b>
  <b>Invariants:</b>
  • lecturer.canEdit() == true
  • visibleToStudents == false
  • hasDeadline == false
  
  <b>Permissions:</b>
  • Create: Lecturer
  • Edit: Lecturer (owner)
  • Delete: Lecturer (owner)
end note

note right of Pending
  <b><<state>> Pending</b>
  <b>Invariants:</b>
  • lecturer.canEdit() == false
  • head.canReview() == true
  • maxWaitTime == 7 days
  
  <b>Automatic Actions:</b>
  • autoNotify(head) @ T+0h
  • autoRemind(head) @ T+3d, T+6d
  • autoEscalate() @ T+7d
end note

note right of Active
  <b><<composite state>> Active</b>
  <b>Invariants:</b>
  • hasAssignedClass() == true
  • groups.size() >= 1
  • milestones.size() >= 4
  
  <b>Enabled Features:</b>
  • Group collaboration
  • Checkpoint submission
  • Progress tracking
  • Real-time monitoring
end note

note bottom
  <b>UML 2.5 State Machine Specification</b>
  
  <b>Guards [condition]:</b>
  • Boolean expressions evaluated on transition
  • Format: [guard1() && guard2()]
  
  <b>Actions / effect:</b>
  • entry / onEntry(): executed when entering state
  • do / whileInState(): continuous activity
  • exit / onExit(): executed when leaving state
  
  <b>Events:</b>
  • Method calls: submit(), approve(), reject()
  • Time events: after(7 days), when(deadline)
  • Signal events: cancelled, completed
  
  <b>State Stereotypes:</b>
  • <<state>>: Simple state
  • <<composite state>>: Contains substates
  • <<substate>>: Nested within composite
  • <<final state>>: Terminal state
  
  <b>Business Rules (OCL):</b>
  context Project::submit()
    pre: self.status == Draft && self.isComplete()
    post: self.status == Pending && head.notified
  
  context Head::approve()
    pre: self.status == Pending && self.meetsCriteria()
    post: self.status == Approved && lecturer.notified
  
  <b>Time Constraints:</b>
  • Pending: max 7 days, auto-escalate
  • Active: 16 weeks (1 semester)
  • Archived: retention 5 years, then purge
  
  <b>Typical Scenarios:</b>
  1. Happy path: Draft → Pending → Approved → Active → Completed → Archived
  2. Revision path: Draft → Pending → Draft → Pending → Approved
  3. Rejection path: Draft → Pending → Rejected → [*]
  4. Suspension path: Active → Suspended → Active → Completed
  5. Cancellation path: Active → Cancelled → Archived
end note

@enduml
